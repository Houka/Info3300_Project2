<html>
<head>
	<title>INFO 3300 - Project 2 (cl795, jsm398, mrm343)</title>
	<link rel="icon" type="image/x-icon" href="favicon.ico" />
	<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/topojson.v2.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.21.0/d3-legend.min.js"></script>
	<style>
        .background {
		  fill: none;
		  pointer-events: all;
		}
		.feature {
		  stroke: black;
		  cursor: pointer;
		  stroke-width: .2;
		}
		.feature.active {
		  fill: orange;
		}
		.mesh {
		  fill: none;
		  stroke: black;
		  stroke-width: .05;
		}
		#map {
			float: left;
		  	border: solid white 1px;
		}
		#sidebar {
			float: left;
		  	border: solid white 1px;
		  	overflow:auto;
		}
		svg{
			border: 1px solid red;
		}
    </style>
</head>
<body>
	<div id="header" class="jumbotron text-center">
		<h1>Pollution and Politics</h1>
	</div>
	<div id="sliderDiv" class="container text-center">
		<b><span id="yearLabel">Year: 1960</span></b>
		<input type="range" id="yearSlider" max="1960" min="2016" value="1960" />
		<span class="pull-left">1960</span>
		<span class="pull-right">2016</span>
	</div>
	<div id="main" class="container-fluid text-center" style="background-color: #ccc;">
		<svg id="map" width="59.8%" height="100%" ></svg>
		<div id="sidebar" width="100%" height="100%">
			<h2 id="info"></h2>
			<svg id="sunburst" width="100%" height="100%"></svg>
			<svg id="lineGraph" width="100%" height="100%"></svg>
		</div>
	</div>
	
	<script> // setup global variables script
		var debug = true;
		var mainDiv = d3.select("#main");

		// screen resolution
		var widthScale = 1500/window.innerWidth;
		var screenHeight = 600 / widthScale;
		var screenWidth = 1500 / widthScale;
		var footerOffset = 30;
		// set main div to screen resolution
		mainDiv
			.style("height", screenHeight-footerOffset)
			.style("width", screenWidth);
		// set sidebar to correct width
		d3.select("#sidebar")
			.style("height", screenHeight-footerOffset)
			.style("width", screenWidth*.39);

		// updating vars
		var WAIT_TIME = 100; // in milliseconds


		// year variables
		var year = 0;
		var prevYear = 0;
		var C = "";
		var selectedCountry = "";
		var prevCountry = "";
		var MIN_YEAR = 1960;
		var MAX_YEAR = 2016;
		var years = d3.range(MAX_YEAR-MIN_YEAR).map(function(i){return i+MIN_YEAR});
		var yearSlider = d3.select("#yearSlider");

		// setting year variables
		yearSlider.property("min", MIN_YEAR);
		yearSlider.property("max", MAX_YEAR);
		year = yearSlider.property("value");
		yearSlider.on("change", function(){
			year = yearSlider.property("value");
			d3.select("#yearLabel").text("Year: "+year);
			log("year changed to: " + year);
		});

		// debug logging function wrapper
		function log(msg){
			if (debug)
				console.log(msg);
		}
	</script>
	<!-- javascripts imported at the end -->
	<script src = "js/LineGraph.js"></script>
	<script src = "js/Sunburst.js"></script>
	<script src = "js/Scatterplot.js"></script>
	<script src = "js/Map.js"></script>
	<script src = "js/DataLoader.js"></script>
	<script> // get, filter, and display data
		/** Updates the display graphics on screen given a year and the data */
		function update(data, mapData, countryNames){
			log("in update()");

			filterYear(data, year);
			
			// main displaying code goes here
			displayMap(data, mapData, countryNames, year, d3.select("#map"));
			displaySideInfo(data, year, selectedCountry, d3.select("#info"));
			displayLineGraph(data, year, selectedCountry, d3.select("#lineGraph"));
			displaySunburst(data, year, d3.select("#sunburst"));

			// put the update function in a interval that updates every 1500 milliseconds
			d3.interval(function() {
				// only update if there was a change in the input for year
				if (prevYear != year){
					log("prev year: "+prevYear+", year:"+year);
					update(data, mapData, countryNames);
					prevYear = year;
				}
				if (selectedCountry != prevCountry){
					log("prev country: "+prevCountry+", country:"+selectedCountry);
					update(data, mapData, countryNames);
					prevCountry = selectedCountry;
				}
			}, WAIT_TIME);
		}

		function displayData(){
			log("in displayData()");
			// Load the csv data files and then runs a callback to display the data
			loadData(function(data, mapData, countryNames) {
				update(data, mapData,countryNames);
			});
		}

		log("starting up... debug = "+debug);
		displayData();
	</script>

</body>
</html>
